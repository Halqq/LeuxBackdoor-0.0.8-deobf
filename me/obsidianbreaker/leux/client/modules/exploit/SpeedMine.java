package me.obsidianbreaker.leux.client.modules.exploit;

import give up;
import me.obsidianbreaker.leux.client.event.events.EventBlock;
import me.obsidianbreaker.leux.client.event.events.EventPacket;
import me.obsidianbreaker.leux.client.guiscreen.settings.Setting;
import me.obsidianbreaker.leux.client.modules.Category;
import me.obsidianbreaker.leux.client.modules.Module;
import me.obsidianbreaker.leux.client.util.Timer;
import me.zero.alpine.fork.listener.EventHandler;
import me.zero.alpine.fork.listener.Listener;
import net.minecraft.block.Block;
import net.minecraft.block.state.IBlockState;
import net.minecraft.entity.Entity;
import net.minecraft.init.Blocks;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketPlayerDigging;
import net.minecraft.util.EnumFacing;
import net.minecraft.util.EnumHand;
import net.minecraft.util.math.AxisAlignedBB;
import net.minecraft.util.math.BlockPos;
import net.minecraft.world.World;

public class SpeedMine extends Module {
  public BlockPos current_pos = null;
  
  public EnumFacing last_facing = null;
  
  public Setting damage = create("Damage Ammount", "SpeedmineDamagaeAmmount", 0.7D, 0.0D, 1.0D);
  
  public Setting allow = create("MultiTask", "SpeedmineMultiTask", false);
  
  public Setting reset = create("Reset", "SpeedmineReset", true);
  
  @EventHandler
  public Listener block_event = new Listener(this::lambda$new$1, new java.util.function.Predicate[0]);
  
  public Setting no_swing = create("No Swing", "SpeedmineNoSwing", false);
  
  public Setting no_delay = create("No Delay", "SpeedmineNoDelay", false);
  
  @EventHandler
  public Listener send_listener = new Listener(this::lambda$new$0, new java.util.function.Predicate[0]);
  
  public BlockPos last_pos = null;
  
  public IBlockState current_block_state = null;
  
  public Setting no_break_anim = create("No Break Anim", "SpeedMineBreakAnim", false);
  
  public Setting double_break = create("Double Break", "SpeedmineDoubleBreak", false);
  
  public Setting mode = create("Mode", "SpeedmineMode", "Damage", combobox(new String[] { "Normal", "Packet", "Damage", "Instant" }));
  
  public Timer timer = new Timer();
  
  public boolean is_mining = false;
  
  public static boolean canBreak(BlockPos paramBlockPos) {
    (give up)null;
    IBlockState iBlockState = mc.field_71441_e.func_180495_p(paramBlockPos);
    Block block = iBlockState.func_177230_c();
    return (block.func_176195_g(iBlockState, (World)mc.field_71441_e, paramBlockPos) != Float.intBitsToFloat(-1.06109542E9F ^ 0x7F40F7E4));
  }
  
  public void show_anim(boolean paramBoolean, BlockPos paramBlockPos, EnumFacing paramEnumFacing) {
    (give up)null;
    this.is_mining = paramBoolean;
    this.last_pos = paramBlockPos;
    this.last_facing = paramEnumFacing;
  }
  
  public void update() {
    (give up)null;
    if (this.current_pos != null && (!mc.field_71441_e.func_180495_p(this.current_pos).equals(this.current_block_state) || mc.field_71441_e.func_180495_p(this.current_pos).func_177230_c() == Blocks.field_150350_a)) {
      this.current_pos = null;
      this.current_block_state = null;
    } 
    if (this.no_delay.get_value(true))
      mc.field_71442_b.field_78781_i = 0; 
    if (this.is_mining && this.last_pos != null && this.last_facing != null && this.no_break_anim.get_value(true))
      mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.ABORT_DESTROY_BLOCK, this.last_pos, this.last_facing)); 
    if (this.reset.get_value(true) && mc.field_71474_y.field_74313_G.func_151470_d() && !this.allow.get_value(true))
      mc.field_71442_b.field_78778_j = false; 
  }
  
  public SpeedMine() {
    super(Category.exploit);
  }
  
  public void lambda$new$1(EventBlock paramEventBlock) {
    (give up)null;
    if (paramEventBlock.get_stage() == 3 && this.reset.get_value(true) && mc.field_71442_b.field_78770_f > Float.intBitsToFloat(1.12889459E9F ^ 0x7E855C7B))
      mc.field_71442_b.field_78778_j = true; 
    if (paramEventBlock.get_stage() == 4 && !this.mode.in("Normal")) {
      if (canBreak(paramEventBlock.pos)) {
        if (this.reset.get_value(true))
          mc.field_71442_b.field_78778_j = false; 
        if (this.mode.in("Packet")) {
          if (this.current_pos == null) {
            this.current_pos = paramEventBlock.pos;
            this.current_block_state = mc.field_71441_e.func_180495_p(this.current_pos);
            this.timer.reset();
          } 
          mc.field_71439_g.func_184609_a(EnumHand.MAIN_HAND);
          mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.START_DESTROY_BLOCK, paramEventBlock.pos, paramEventBlock.facing));
          mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, paramEventBlock.pos, paramEventBlock.facing));
          paramEventBlock.cancel();
        } 
        if (this.mode.in("Damage") && mc.field_71442_b.field_78770_f >= this.damage.get_value(1))
          mc.field_71442_b.field_78770_f = Float.intBitsToFloat(1.09029542E9F ^ 0x7F7C9663); 
        if (this.mode.in("Instant")) {
          mc.field_71439_g.func_184609_a(EnumHand.MAIN_HAND);
          mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.START_DESTROY_BLOCK, paramEventBlock.pos, paramEventBlock.facing));
          mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, paramEventBlock.pos, paramEventBlock.facing));
          mc.field_71442_b.func_187103_a(paramEventBlock.pos);
          mc.field_71441_e.func_175698_g(paramEventBlock.pos);
        } 
      } 
      if (this.double_break.get_value(true)) {
        BlockPos blockPos = paramEventBlock.pos.func_177984_a();
        if (canBreak(blockPos) && mc.field_71439_g.func_70011_f(blockPos.func_177958_n(), blockPos.func_177956_o(), blockPos.func_177952_p()) <= 5.0D) {
          mc.field_71439_g.func_184609_a(EnumHand.MAIN_HAND);
          mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.START_DESTROY_BLOCK, blockPos, paramEventBlock.facing));
          mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayerDigging(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK, blockPos, paramEventBlock.facing));
          mc.field_71442_b.func_187103_a(blockPos);
          mc.field_71441_e.func_175698_g(blockPos);
        } 
      } 
    } 
  }
  
  public String array_detail() {
    (give up)null;
    return this.mode.get_current_value();
  }
  
  public void show_anim() {
    (give up)null;
    show_anim(false, (BlockPos)null, (EnumFacing)null);
  }
  
  public void lambda$new$0(EventPacket.SendPacket paramSendPacket) {
    (give up)null;
    if (this.no_swing.get_value(true) && paramSendPacket.get_packet() instanceof net.minecraft.network.play.client.CPacketAnimation)
      paramSendPacket.cancel(); 
    if (this.no_break_anim.get_value(true) && paramSendPacket.get_packet() instanceof CPacketPlayerDigging) {
      CPacketPlayerDigging cPacketPlayerDigging = (CPacketPlayerDigging)paramSendPacket.get_packet();
      for (Entity entity : mc.field_71441_e.func_72839_b(null, new AxisAlignedBB(cPacketPlayerDigging.func_179715_a()))) {
        if (entity instanceof net.minecraft.entity.item.EntityEnderCrystal) {
          show_anim();
          return;
        } 
      } 
      if (cPacketPlayerDigging.func_180762_c().equals(CPacketPlayerDigging.Action.START_DESTROY_BLOCK))
        show_anim(true, cPacketPlayerDigging.func_179715_a(), cPacketPlayerDigging.func_179714_b()); 
      if (cPacketPlayerDigging.func_180762_c().equals(CPacketPlayerDigging.Action.STOP_DESTROY_BLOCK))
        show_anim(); 
    } 
  }
}
