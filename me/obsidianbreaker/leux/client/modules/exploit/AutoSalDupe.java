package me.obsidianbreaker.leux.client.modules.exploit;

import give up;
import java.util.Comparator;
import me.obsidianbreaker.leux.client.event.events.EventMove;
import me.obsidianbreaker.leux.client.guiscreen.settings.Setting;
import me.obsidianbreaker.leux.client.modules.Category;
import me.obsidianbreaker.leux.client.modules.Module;
import me.obsidianbreaker.leux.client.util.Timer;
import me.zero.alpine.fork.listener.EventHandler;
import me.zero.alpine.fork.listener.Listener;
import net.minecraft.client.gui.inventory.GuiScreenHorseInventory;
import net.minecraft.entity.Entity;
import net.minecraft.entity.passive.AbstractChestHorse;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.init.Items;
import net.minecraft.inventory.ClickType;
import net.minecraft.item.ItemBlock;
import net.minecraft.item.ItemStack;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketUseEntity;
import net.minecraft.util.EnumHand;
import net.minecraftforge.event.entity.EntityJoinWorldEvent;
import org.lwjgl.input.Keyboard;

public class AutoSalDupe extends Module {
  public boolean start = false;
  
  public int itemsMoved;
  
  public Setting shulkerOnly = create("OnlyShulkers", "AutoDupeShulkerOnly", true);
  
  public Setting hitGround = create("GroundCheck", "AutoDupeGround", true);
  
  public GuiScreenHorseInventory l_Chest;
  
  public int itemsToDupe;
  
  public int itemsDropped;
  
  public boolean noBypass = false;
  
  public boolean doDrop = false;
  
  public boolean doChest = false;
  
  public Setting Delay = create("Delay", "AutoDupeDelay", 1.52D, 0.15D, 10.0D);
  
  @EventHandler
  public Listener updateListener = new Listener(this::lambda$new$1, new java.util.function.Predicate[0]);
  
  public boolean grounded = false;
  
  public boolean doSneak = false;
  
  public Timer timer = new Timer();
  
  @EventHandler
  public Listener OnWorldEvent = new Listener(this::lambda$new$2, new java.util.function.Predicate[0]);
  
  public boolean finished = false;
  
  public boolean ignoreMountBypass() {
    (give up)null;
    return this.noBypass;
  }
  
  public boolean isValidEntity(Entity paramEntity) {
    (give up)null;
    if (paramEntity instanceof AbstractChestHorse) {
      AbstractChestHorse abstractChestHorse = (AbstractChestHorse)paramEntity;
      return (!abstractChestHorse.func_70631_g_() && abstractChestHorse.func_110248_bS());
    } 
    return false;
  }
  
  public static Float lambda$doDupe$3(Entity paramEntity) {
    (give up)null;
    return Float.valueOf(mc.field_71439_g.func_70032_d(paramEntity));
  }
  
  public static Float lambda$null$0(Entity paramEntity) {
    (give up)null;
    return Float.valueOf(mc.field_71439_g.func_70032_d(paramEntity));
  }
  
  public void doDupe() {
    (give up)null;
    this.noBypass = true;
    Entity entity = mc.field_71441_e.field_72996_f.stream().filter(this::isValidEntity).min(Comparator.comparing(AutoSalDupe::lambda$doDupe$3)).orElse(null);
    if (entity instanceof AbstractChestHorse) {
      mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketUseEntity(entity, EnumHand.MAIN_HAND, entity.func_174791_d()));
      this.noBypass = false;
      this.doDrop = true;
    } 
  }
  
  public void lambda$new$1(EventMove paramEventMove) {
    (give up)null;
    if (Keyboard.isKeyDown(1)) {
      toggle();
      return;
    } 
    if (this.finished) {
      this.finished = false;
      this.itemsMoved = 0;
      this.itemsDropped = 0;
      this.start = true;
      return;
    } 
    if (!this.timer.passed((this.Delay.get_value(0) * Float.intBitsToFloat(1.03469005E9F ^ 0x7F641E1F))))
      return; 
    this.timer.reset();
    if (this.doSneak) {
      if (!mc.field_71439_g.func_70093_af()) {
        mc.field_71474_y.field_74311_E.field_74513_e = true;
        return;
      } 
    } else {
      if (this.grounded && mc.field_71439_g.field_70122_E) {
        this.grounded = false;
        this.finished = true;
        return;
      } 
      if (this.start && is_active()) {
        this.itemsToDupe = 0;
        this.itemsMoved = 0;
        Entity entity = mc.field_71441_e.field_72996_f.stream().filter(this::isValidEntity).min(Comparator.comparing(AutoSalDupe::lambda$null$0)).orElse(null);
        if (entity instanceof AbstractChestHorse) {
          AbstractChestHorse abstractChestHorse = (AbstractChestHorse)entity;
          if (!abstractChestHorse.func_190695_dh()) {
            int i = getChestInHotbar();
            if (i != -1 && mc.field_71439_g.field_71071_by.field_70461_c != i) {
              mc.field_71439_g.field_71071_by.field_70461_c = i;
              mc.field_71442_b.func_78765_e();
              mc.field_71442_b.func_187097_a((EntityPlayer)mc.field_71439_g, (Entity)abstractChestHorse, EnumHand.MAIN_HAND);
            } else {
              if (mc.field_71439_g.field_71071_by.field_70461_c != i) {
                toggle();
                return;
              } 
              mc.field_71442_b.func_187097_a((EntityPlayer)mc.field_71439_g, (Entity)abstractChestHorse, EnumHand.MAIN_HAND);
            } 
          } 
          this.start = false;
          mc.field_71442_b.func_187097_a((EntityPlayer)mc.field_71439_g, (Entity)abstractChestHorse, EnumHand.MAIN_HAND);
          mc.field_71439_g.func_175163_u();
          this.doChest = true;
        } 
      } 
      if (this.doChest && !(mc.field_71462_r instanceof GuiScreenHorseInventory)) {
        this.doChest = false;
        this.start = true;
        return;
      } 
      if (mc.field_71462_r instanceof GuiScreenHorseInventory) {
        this.l_Chest = (GuiScreenHorseInventory)mc.field_71462_r;
        this.itemsToDupe = getItemsToDupe();
        byte b = 2;
        while (b < this.l_Chest.field_147029_w.func_70302_i_() + 1) {
          ItemStack itemStack = this.l_Chest.field_147029_w.func_70301_a(b);
          if (((this.itemsToDupe == 0 || this.itemsMoved == this.l_Chest.field_147029_w.func_70302_i_() - 2) && this.doChest) || (this.itemsDropped >= this.itemsMoved && this.doDrop))
            break; 
          if ((itemStack.func_190926_b() || itemStack.func_77973_b() == Items.field_190931_a) && this.doChest) {
            HandleStoring(this.l_Chest.field_147002_h.field_75152_c, this.l_Chest.field_147029_w.func_70302_i_() - 9);
            this.itemsToDupe--;
            this.itemsMoved = getItemsInRidingEntity();
            return;
          } 
          if (this.doChest || (this.shulkerOnly.get_value(true) && !(itemStack.func_77973_b() instanceof net.minecraft.item.ItemShulkerBox)) || itemStack.func_190926_b() || !this.doDrop) {
            b++;
            continue;
          } 
          if (canStore()) {
            mc.field_71442_b.func_187098_a(mc.field_71439_g.field_71070_bA.field_75152_c, b, 0, ClickType.QUICK_MOVE, (EntityPlayer)mc.field_71439_g);
          } else {
            mc.field_71442_b.func_187098_a(this.l_Chest.field_147002_h.field_75152_c, b, -999, ClickType.THROW, (EntityPlayer)mc.field_71439_g);
          } 
          this.itemsDropped++;
          return;
        } 
        if (this.doChest) {
          this.doChest = false;
          doDupe();
          return;
        } 
        if (this.doDrop) {
          this.doDrop = false;
          mc.field_71439_g.func_71053_j();
          mc.field_71474_y.field_74311_E.field_74513_e = true;
          this.doSneak = true;
        } 
      } 
      return;
    } 
    mc.field_71474_y.field_74311_E.field_74513_e = false;
    this.doSneak = false;
    if (!this.hitGround.get_value(true)) {
      this.finished = true;
    } else {
      this.grounded = true;
    } 
  }
  
  public AutoSalDupe() {
    super(Category.exploit);
  }
  
  public void disable() {
    (give up)null;
    super.disable();
    this.noBypass = false;
    this.doDrop = false;
    this.doChest = false;
    this.doSneak = false;
    this.start = false;
    this.finished = false;
    this.grounded = false;
    this.itemsToDupe = 0;
    this.itemsMoved = 0;
    this.itemsDropped = 0;
    this.timer.reset();
  }
  
  public boolean canStore() {
    (give up)null;
    byte b = 9;
    while (b < mc.field_71439_g.field_71069_bz.field_75151_b.size() - 1) {
      ItemStack itemStack = mc.field_71439_g.field_71069_bz.func_75139_a(b).func_75211_c();
      if (!itemStack.func_190926_b() && itemStack.func_77973_b() != Items.field_190931_a) {
        b++;
        continue;
      } 
      return true;
    } 
    return false;
  }
  
  public int getChestInHotbar() {
    (give up)null;
    byte b = 0;
    while (true) {
      9;
      ItemStack itemStack = mc.field_71439_g.field_71071_by.func_70301_a(b);
      if (itemStack == ItemStack.field_190927_a || !(itemStack.func_77973_b() instanceof ItemBlock) || !(((ItemBlock)itemStack.func_77973_b()).func_179223_d() instanceof net.minecraft.block.BlockChest))
        continue; 
      return b;
    } 
  }
  
  public int getItemsInRidingEntity() {
    (give up)null;
    byte b1 = 0;
    for (byte b2 = 2; b2 < this.l_Chest.field_147029_w.func_70302_i_() + 1; b2++) {
      ItemStack itemStack = this.l_Chest.field_147029_w.func_70301_a(b2);
      if (!itemStack.func_190926_b() && itemStack.func_77973_b() != Items.field_190931_a)
        b1++; 
    } 
    return b1;
  }
  
  public int getItemsToDupe() {
    (give up)null;
    int i = 0;
    for (byte b = 9; b < mc.field_71439_g.field_71069_bz.field_75151_b.size() - 1; b++) {
      ItemStack itemStack = mc.field_71439_g.field_71069_bz.func_75139_a(b).func_75211_c();
      if (!itemStack.func_190926_b() && itemStack.func_77973_b() != Items.field_190931_a && (itemStack.func_77973_b() instanceof net.minecraft.item.ItemShulkerBox || !this.shulkerOnly.get_value(true)))
        i++; 
    } 
    if (i > this.l_Chest.field_147029_w.func_70302_i_() - 1)
      i = this.l_Chest.field_147029_w.func_70302_i_() - 1; 
    return i;
  }
  
  public void HandleStoring(int paramInt1, int paramInt2) {
    (give up)null;
    byte b = 9;
    while (b < mc.field_71439_g.field_71069_bz.field_75151_b.size() - 1) {
      ItemStack itemStack = mc.field_71439_g.field_71069_bz.func_75139_a(b).func_75211_c();
      if (itemStack.func_190926_b() || itemStack.func_77973_b() == Items.field_190931_a || (!(itemStack.func_77973_b() instanceof net.minecraft.item.ItemShulkerBox) && this.shulkerOnly.get_value(true))) {
        b++;
        continue;
      } 
      mc.field_71442_b.func_187098_a(paramInt1, b + paramInt2, 0, ClickType.QUICK_MOVE, (EntityPlayer)mc.field_71439_g);
      return;
    } 
  }
  
  public void lambda$new$2(EntityJoinWorldEvent paramEntityJoinWorldEvent) {
    (give up)null;
    if (paramEntityJoinWorldEvent.getEntity() == mc.field_71439_g)
      toggle(); 
  }
  
  public void enable() {
    (give up)null;
    super.enable();
    this.timer.reset();
    this.start = true;
  }
}
